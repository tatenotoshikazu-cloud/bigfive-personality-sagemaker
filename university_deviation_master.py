# -*- coding: utf-8 -*-
"""
å¤§å­¦åå·®å€¤ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿

ã€ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã€‘
1. Claude AI çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ï¼ˆ2025å¹´1æœˆæ™‚ç‚¹ï¼‰
2. Wikipediaã€Œæ—¥æœ¬ã®å¤§å­¦ä¸€è¦§ã€ï¼ˆCC BY-SA 3.0ï¼‰
   https://ja.wikipedia.org/wiki/æ—¥æœ¬ã®å¤§å­¦ä¸€è¦§
3. å„ç¨®å…¬é–‹æƒ…å ±ã‚’ç·åˆçš„ã«åˆ¤æ–­

ã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã€‘
- ã“ã®ãƒ‡ãƒ¼ã‚¿ã¯CC BY-SA 3.0ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§æä¾›ã•ã‚Œã¾ã™
- å•†ç”¨åˆ©ç”¨å¯ã€æ”¹å¤‰å¯ã€å‡ºå…¸æ˜è¨˜å¿…é ˆ

ã€æ›´æ–°å±¥æ­´ã€‘
- 2025-10-25: åˆç‰ˆä½œæˆï¼ˆClaude AI + Wikipediaï¼‰

ã€æ³¨æ„äº‹é …ã€‘
- åå·®å€¤ã¯ç›®å®‰ã§ã‚ã‚Šã€å­¦éƒ¨ãƒ»å­¦ç§‘ã«ã‚ˆã‚Šç•°ãªã‚Šã¾ã™
- å¹´åº¦ã«ã‚ˆã‚Šå¤‰å‹•ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
- ã‚ˆã‚Šæ­£ç¢ºãªãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ãªå ´åˆã¯å…¬å¼æƒ…å ±ã‚’å‚ç…§ã—ã¦ãã ã•ã„
"""

# ========================================
# åå·®å€¤ã‚¹ã‚³ã‚¢å®šç¾©ï¼ˆ35-75ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
# ========================================

UNIVERSITY_DEVIATION_SCORES = {
    # ==========================================
    # Tier 1: åå·®å€¤70ä»¥ä¸Šï¼ˆè¶…ãƒˆãƒƒãƒ—ï¼‰
    # ==========================================
    'æ±äº¬å¤§å­¦': 75,
    'äº¬éƒ½å¤§å­¦': 74,
    'æ±äº¬å·¥æ¥­å¤§å­¦': 72,
    'ä¸€æ©‹å¤§å­¦': 72,

    # ==========================================
    # Tier 2: åå·®å€¤65-69ï¼ˆãƒˆãƒƒãƒ—å›½ç«‹ãƒ»ç§ç«‹ï¼‰
    # ==========================================
    'å¤§é˜ªå¤§å­¦': 68,
    'æ±åŒ—å¤§å­¦': 67,
    'åå¤å±‹å¤§å­¦': 67,
    'ä¹å·å¤§å­¦': 66,
    'åŒ—æµ·é“å¤§å­¦': 66,
    'ç¥æˆ¸å¤§å­¦': 65,

    # ãƒˆãƒƒãƒ—ç§ç«‹
    'æ…¶æ‡‰ç¾©å¡¾å¤§å­¦': 68,
    'æ—©ç¨²ç”°å¤§å­¦': 67,
    'ä¸Šæ™ºå¤§å­¦': 65,
    'å›½éš›åŸºç£æ•™å¤§å­¦': 65,

    # ==========================================
    # Tier 3: åå·®å€¤60-64ï¼ˆMARCHã€é–¢é–¢åŒç«‹ã€æº–é›£é–¢å›½ç«‹ï¼‰
    # ==========================================

    # MARCHï¼ˆæ˜æ²»ãƒ»é’å±±å­¦é™¢ãƒ»ç«‹æ•™ãƒ»ä¸­å¤®ãƒ»æ³•æ”¿ï¼‰
    'æ˜æ²»å¤§å­¦': 62,
    'é’å±±å­¦é™¢å¤§å­¦': 61,
    'ç«‹æ•™å¤§å­¦': 62,
    'ä¸­å¤®å¤§å­¦': 60,
    'æ³•æ”¿å¤§å­¦': 60,

    # é–¢é–¢åŒç«‹ï¼ˆé–¢è¥¿ãƒ»é–¢è¥¿å­¦é™¢ãƒ»åŒå¿—ç¤¾ãƒ»ç«‹å‘½é¤¨ï¼‰
    'åŒå¿—ç¤¾å¤§å­¦': 63,
    'é–¢è¥¿å­¦é™¢å¤§å­¦': 61,
    'ç«‹å‘½é¤¨å¤§å­¦': 60,
    'é–¢è¥¿å¤§å­¦': 59,

    # æº–é›£é–¢å›½ç«‹
    'ç­‘æ³¢å¤§å­¦': 63,
    'åƒè‘‰å¤§å­¦': 62,
    'æ¨ªæµœå›½ç«‹å¤§å­¦': 62,
    'åºƒå³¶å¤§å­¦': 61,
    'å²¡å±±å¤§å­¦': 60,
    'é‡‘æ²¢å¤§å­¦': 60,

    # ãã®ä»–æœ‰åŠ›ç§ç«‹
    'æ±äº¬ç†ç§‘å¤§å­¦': 62,
    'å­¦ç¿’é™¢å¤§å­¦': 60,
    'æ´¥ç”°å¡¾å¤§å­¦': 60,
    'æ±äº¬å¥³å­å¤§å­¦': 59,
    'æ—¥æœ¬å¥³å­å¤§å­¦': 59,

    # ==========================================
    # Tier 4: åå·®å€¤55-59ï¼ˆä¸­å …å›½ç«‹ãƒ»æˆæˆæ˜å­¦ç¨åœ‹æ­¦ï¼‰
    # ==========================================

    # åœ°æ–¹å›½ç«‹å¤§å­¦ï¼ˆé§…å¼å¤§å­¦ï¼‰
    'é™å²¡å¤§å­¦': 58,
    'æ–°æ½Ÿå¤§å­¦': 57,
    'ä¿¡å·å¤§å­¦': 57,
    'åŸ¼ç‰å¤§å­¦': 57,
    'ä¸‰é‡å¤§å­¦': 56,
    'æ»‹è³€å¤§å­¦': 56,
    'é•·å´å¤§å­¦': 56,
    'ç†Šæœ¬å¤§å­¦': 56,

    # æˆæˆæ˜å­¦ç¨åœ‹æ­¦
    'æˆåŸå¤§å­¦': 58,
    'æˆè¹Šå¤§å­¦': 58,
    'æ˜æ²»å­¦é™¢å¤§å­¦': 57,
    'ç¨å”å¤§å­¦': 56,
    'åœ‹å­¸é™¢å¤§å­¸': 56,
    'æ­¦è”µå¤§å­¦': 56,

    # æ—¥æ±é§’å°‚ï¼ˆæ—¥æœ¬ãƒ»æ±æ´‹ãƒ»é§’æ¾¤ãƒ»å°‚ä¿®ï¼‰
    'æ—¥æœ¬å¤§å­¦': 55,
    'æ±æ´‹å¤§å­¦': 54,
    'é§’æ¾¤å¤§å­¦': 53,
    'å°‚ä¿®å¤§å­¦': 52,

    # ç”£è¿‘ç”²é¾ï¼ˆäº¬éƒ½ç”£æ¥­ãƒ»è¿‘ç•¿ãƒ»ç”²å—ãƒ»é¾è°·ï¼‰
    'è¿‘ç•¿å¤§å­¦': 55,
    'äº¬éƒ½ç”£æ¥­å¤§å­¦': 54,
    'ç”²å—å¤§å­¦': 53,
    'é¾è°·å¤§å­¦': 52,

    # ==========================================
    # Tier 5: åå·®å€¤50-54ï¼ˆä¸­å …ç§ç«‹ï¼‰
    # ==========================================
    'æ±æµ·å¤§å­¦': 52,
    'äºœç´°äºœå¤§å­¦': 51,
    'å¸äº¬å¤§å­¦': 51,
    'å›½å£«èˆ˜å¤§å­¦': 50,
    'å¤§æ±æ–‡åŒ–å¤§å­¦': 50,
    'æ±äº¬çµŒæ¸ˆå¤§å­¦': 50,
    'æ‹“æ®–å¤§å­¦': 50,

    # ==========================================
    # Tier 6: åå·®å€¤45-49ï¼ˆãã®ä»–ç§ç«‹ãƒ»åœ°æ–¹å›½ç«‹ï¼‰
    # ==========================================
    'æ¡œç¾æ—å¤§å­¦': 48,
    'ç«‹æ­£å¤§å­¦': 47,
    'å¤§æ­£å¤§å­¦': 46,
    'æ·‘å¾³å¤§å­¦': 45,

    # ==========================================
    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: åå·®å€¤45ï¼ˆæœªå®šç¾©å¤§å­¦ï¼‰
    # ==========================================
    'ãã®ä»–': 45,
}


# ========================================
# ãƒ†ã‚£ã‚¢åˆ†é¡ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—åŒ–ï¼‰
# ========================================

UNIVERSITY_TIERS = {
    # Tier 1.0: è¶…ãƒˆãƒƒãƒ—
    1.0: ['æ±äº¬å¤§å­¦', 'äº¬éƒ½å¤§å­¦'],

    # Tier 0.95: ãƒˆãƒƒãƒ—å›½ç«‹
    0.95: ['æ±äº¬å·¥æ¥­å¤§å­¦', 'ä¸€æ©‹å¤§å­¦'],

    # Tier 0.9: æ—§å¸å¤§
    0.9: ['å¤§é˜ªå¤§å­¦', 'æ±åŒ—å¤§å­¦', 'åå¤å±‹å¤§å­¦', 'ä¹å·å¤§å­¦', 'åŒ—æµ·é“å¤§å­¦'],

    # Tier 0.85: æ—©æ…¶
    0.85: ['æ…¶æ‡‰ç¾©å¡¾å¤§å­¦', 'æ—©ç¨²ç”°å¤§å­¦'],

    # Tier 0.75: æº–é›£é–¢å›½ç«‹ãƒ»ä¸Šæ™ºICU
    0.75: ['ç¥æˆ¸å¤§å­¦', 'ç­‘æ³¢å¤§å­¦', 'åƒè‘‰å¤§å­¦', 'æ¨ªæµœå›½ç«‹å¤§å­¦', 'ä¸Šæ™ºå¤§å­¦', 'å›½éš›åŸºç£æ•™å¤§å­¦'],

    # Tier 0.7: MARCHã€é–¢é–¢åŒç«‹
    0.7: ['æ˜æ²»å¤§å­¦', 'é’å±±å­¦é™¢å¤§å­¦', 'ç«‹æ•™å¤§å­¦', 'ä¸­å¤®å¤§å­¦', 'æ³•æ”¿å¤§å­¦',
          'åŒå¿—ç¤¾å¤§å­¦', 'é–¢è¥¿å­¦é™¢å¤§å­¦', 'ç«‹å‘½é¤¨å¤§å­¦', 'é–¢è¥¿å¤§å­¦'],

    # Tier 0.6: åœ°æ–¹å›½ç«‹ã€æˆæˆæ˜å­¦
    0.6: ['åºƒå³¶å¤§å­¦', 'å²¡å±±å¤§å­¦', 'é‡‘æ²¢å¤§å­¦', 'é™å²¡å¤§å­¦', 'æ–°æ½Ÿå¤§å­¦',
          'æˆåŸå¤§å­¦', 'æˆè¹Šå¤§å­¦', 'æ˜æ²»å­¦é™¢å¤§å­¦', 'æ±äº¬ç†ç§‘å¤§å­¦'],

    # Tier 0.5: æ—¥æ±é§’å°‚ã€ç”£è¿‘ç”²é¾
    0.5: ['æ—¥æœ¬å¤§å­¦', 'æ±æ´‹å¤§å­¦', 'é§’æ¾¤å¤§å­¦', 'å°‚ä¿®å¤§å­¦',
          'è¿‘ç•¿å¤§å­¦', 'äº¬éƒ½ç”£æ¥­å¤§å­¦', 'ç”²å—å¤§å­¦', 'é¾è°·å¤§å­¦'],

    # Tier 0.4: ãã®ä»–
    0.4: ['ãã®ä»–'],
}


# ========================================
# ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆä¾¿åˆ©é–¢æ•°ç”¨ï¼‰
# ========================================

UNIVERSITY_GROUPS = {
    'MARCH': ['æ˜æ²»å¤§å­¦', 'é’å±±å­¦é™¢å¤§å­¦', 'ç«‹æ•™å¤§å­¦', 'ä¸­å¤®å¤§å­¦', 'æ³•æ”¿å¤§å­¦'],
    'é–¢é–¢åŒç«‹': ['é–¢è¥¿å¤§å­¦', 'é–¢è¥¿å­¦é™¢å¤§å­¦', 'åŒå¿—ç¤¾å¤§å­¦', 'ç«‹å‘½é¤¨å¤§å­¦'],
    'æ—¥æ±é§’å°‚': ['æ—¥æœ¬å¤§å­¦', 'æ±æ´‹å¤§å­¦', 'é§’æ¾¤å¤§å­¦', 'å°‚ä¿®å¤§å­¦'],
    'ç”£è¿‘ç”²é¾': ['äº¬éƒ½ç”£æ¥­å¤§å­¦', 'è¿‘ç•¿å¤§å­¦', 'ç”²å—å¤§å­¦', 'é¾è°·å¤§å­¦'],
    'æˆæˆæ˜å­¦': ['æˆåŸå¤§å­¦', 'æˆè¹Šå¤§å­¦', 'æ˜æ²»å­¦é™¢å¤§å­¦'],
    'æ—©æ…¶': ['æ—©ç¨²ç”°å¤§å­¦', 'æ…¶æ‡‰ç¾©å¡¾å¤§å­¦'],
    'æ—§å¸å¤§': ['æ±äº¬å¤§å­¦', 'äº¬éƒ½å¤§å­¦', 'å¤§é˜ªå¤§å­¦', 'æ±åŒ—å¤§å­¦', 'åå¤å±‹å¤§å­¦', 'ä¹å·å¤§å­¦', 'åŒ—æµ·é“å¤§å­¦'],
}


# ========================================
# ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
# ========================================

def get_deviation_score(university_name: str) -> float:
    """
    å¤§å­¦åã‹ã‚‰åå·®å€¤ã‚¹ã‚³ã‚¢ã‚’å–å¾—

    Args:
        university_name: å¤§å­¦åï¼ˆä¾‹: 'æ±äº¬å¤§å­¦'ï¼‰

    Returns:
        åå·®å€¤ã‚¹ã‚³ã‚¢ï¼ˆ35-75ï¼‰ã€æœªå®šç¾©ã®å ´åˆã¯45

    Examples:
        >>> get_deviation_score('æ±äº¬å¤§å­¦')
        75
        >>> get_deviation_score('æ˜æ²»å¤§å­¦')
        62
        >>> get_deviation_score('â—‹â—‹å·¥æ¥­å¤§å­¦')
        45
    """
    return UNIVERSITY_DEVIATION_SCORES.get(university_name, UNIVERSITY_DEVIATION_SCORES['ãã®ä»–'])


def normalize_deviation_score(score: float) -> float:
    """
    åå·®å€¤ã‚¹ã‚³ã‚¢ï¼ˆ35-75ï¼‰ã‚’ 0-1 ã‚¹ã‚±ãƒ¼ãƒ«ã«æ­£è¦åŒ–

    Args:
        score: åå·®å€¤ã‚¹ã‚³ã‚¢ï¼ˆ35-75ï¼‰

    Returns:
        æ­£è¦åŒ–ã‚¹ã‚³ã‚¢ï¼ˆ0.0-1.0ï¼‰

    Examples:
        >>> normalize_deviation_score(75)  # æ±å¤§
        1.0
        >>> normalize_deviation_score(62)  # MARCH
        0.675
        >>> normalize_deviation_score(45)  # ãã®ä»–
        0.25
    """
    MIN_SCORE = 35
    MAX_SCORE = 75
    return (score - MIN_SCORE) / (MAX_SCORE - MIN_SCORE)


def get_normalized_score(university_name: str) -> float:
    """
    å¤§å­¦åã‹ã‚‰æ­£è¦åŒ–ã‚¹ã‚³ã‚¢ï¼ˆ0-1ï¼‰ã‚’ç›´æ¥å–å¾—

    Args:
        university_name: å¤§å­¦å

    Returns:
        æ­£è¦åŒ–ã‚¹ã‚³ã‚¢ï¼ˆ0.0-1.0ï¼‰

    Examples:
        >>> get_normalized_score('æ±äº¬å¤§å­¦')
        1.0
        >>> get_normalized_score('æ˜æ²»å¤§å­¦')
        0.675
    """
    score = get_deviation_score(university_name)
    return normalize_deviation_score(score)


def get_tier_score(university_name: str) -> float:
    """
    å¤§å­¦åã‹ã‚‰ãƒ†ã‚£ã‚¢ã‚¹ã‚³ã‚¢ï¼ˆ0-1ï¼‰ã‚’å–å¾—

    Args:
        university_name: å¤§å­¦å

    Returns:
        ãƒ†ã‚£ã‚¢ã‚¹ã‚³ã‚¢ï¼ˆ0.4-1.0ï¼‰

    Examples:
        >>> get_tier_score('æ±äº¬å¤§å­¦')
        1.0
        >>> get_tier_score('æ˜æ²»å¤§å­¦')
        0.7
    """
    for tier_value, universities in UNIVERSITY_TIERS.items():
        if university_name in universities:
            return tier_value
    return 0.4  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ


def is_in_group(university_name: str, group_name: str) -> bool:
    """
    å¤§å­¦ãŒç‰¹å®šã‚°ãƒ«ãƒ¼ãƒ—ã«å±ã™ã‚‹ã‹åˆ¤å®š

    Args:
        university_name: å¤§å­¦å
        group_name: ã‚°ãƒ«ãƒ¼ãƒ—åï¼ˆ'MARCH', 'é–¢é–¢åŒç«‹', etc.ï¼‰

    Returns:
        True if university is in the group, False otherwise

    Examples:
        >>> is_in_group('æ˜æ²»å¤§å­¦', 'MARCH')
        True
        >>> is_in_group('æ±äº¬å¤§å­¦', 'MARCH')
        False
    """
    return university_name in UNIVERSITY_GROUPS.get(group_name, [])


def get_university_group(university_name: str) -> str:
    """
    å¤§å­¦ãŒå±ã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—åã‚’å–å¾—

    Args:
        university_name: å¤§å­¦å

    Returns:
        ã‚°ãƒ«ãƒ¼ãƒ—åï¼ˆè©²å½“ãªã—ã®å ´åˆã¯'ãã®ä»–'ï¼‰

    Examples:
        >>> get_university_group('æ˜æ²»å¤§å­¦')
        'MARCH'
        >>> get_university_group('æ±äº¬å¤§å­¦')
        'æ—§å¸å¤§'
    """
    for group_name, universities in UNIVERSITY_GROUPS.items():
        if university_name in universities:
            return group_name
    return 'ãã®ä»–'


# ========================================
# ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ãƒ»çµ±è¨ˆæƒ…å ±
# ========================================

def get_statistics():
    """
    ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã®çµ±è¨ˆæƒ…å ±ã‚’å–å¾—

    Returns:
        çµ±è¨ˆæƒ…å ±ã®è¾æ›¸
    """
    scores = [v for k, v in UNIVERSITY_DEVIATION_SCORES.items() if k != 'ãã®ä»–']

    return {
        'å¤§å­¦æ•°': len(scores),
        'æœ€é«˜åå·®å€¤': max(scores),
        'æœ€ä½åå·®å€¤': min(scores),
        'å¹³å‡åå·®å€¤': sum(scores) / len(scores),
        'Tieræ•°': len(UNIVERSITY_TIERS),
        'ã‚°ãƒ«ãƒ¼ãƒ—æ•°': len(UNIVERSITY_GROUPS),
    }


def validate_data():
    """
    ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯

    Returns:
        æ¤œè¨¼çµæœï¼ˆå•é¡Œãªã‘ã‚Œã°Trueï¼‰
    """
    issues = []

    # åå·®å€¤ç¯„å›²ãƒã‚§ãƒƒã‚¯
    for univ, score in UNIVERSITY_DEVIATION_SCORES.items():
        if univ != 'ãã®ä»–' and not (35 <= score <= 75):
            issues.append(f'{univ}: åå·®å€¤ {score} ãŒç¯„å›²å¤–ï¼ˆ35-75ï¼‰')

    # ãƒ†ã‚£ã‚¢å®šç¾©ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
    all_tier_univs = []
    for universities in UNIVERSITY_TIERS.values():
        all_tier_univs.extend(universities)

    duplicates = [u for u in all_tier_univs if all_tier_univs.count(u) > 1]
    if duplicates:
        issues.append(f'ãƒ†ã‚£ã‚¢å®šç¾©ã®é‡è¤‡: {set(duplicates)}')

    if issues:
        print('âš ï¸ ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ã‚¨ãƒ©ãƒ¼:')
        for issue in issues:
            print(f'  - {issue}')
        return False
    else:
        print('âœ… ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼OK')
        return True


# ========================================
# ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œï¼ˆãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ¢ï¼‰
# ========================================

if __name__ == '__main__':
    print('=' * 60)
    print('å¤§å­¦åå·®å€¤ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ - å‹•ä½œç¢ºèª')
    print('=' * 60)

    # çµ±è¨ˆæƒ…å ±è¡¨ç¤º
    print('\nğŸ“Š çµ±è¨ˆæƒ…å ±:')
    stats = get_statistics()
    for key, value in stats.items():
        print(f'  {key}: {value}')

    # ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
    print('\nğŸ” ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼:')
    validate_data()

    # ä½¿ç”¨ä¾‹
    print('\nğŸ“ ä½¿ç”¨ä¾‹:')
    test_universities = ['æ±äº¬å¤§å­¦', 'æ˜æ²»å¤§å­¦', 'æ—¥æœ¬å¤§å­¦', 'â—‹â—‹å·¥æ¥­å¤§å­¦']

    for univ in test_universities:
        dev_score = get_deviation_score(univ)
        normalized = get_normalized_score(univ)
        tier = get_tier_score(univ)
        group = get_university_group(univ)

        print(f'\n  {univ}:')
        print(f'    åå·®å€¤: {dev_score}')
        print(f'    æ­£è¦åŒ–ã‚¹ã‚³ã‚¢: {normalized:.3f}')
        print(f'    ãƒ†ã‚£ã‚¢ã‚¹ã‚³ã‚¢: {tier}')
        print(f'    ã‚°ãƒ«ãƒ¼ãƒ—: {group}')

    print('\n' + '=' * 60)
    print('ãƒ†ã‚¹ãƒˆå®Œäº†')
    print('=' * 60)
